@* @model Indrani_Jewellers.Models.GenerateInvoice

<div class="row">
    <div class="col-lg-12">
        <div class="card" id="employeeForm">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header align-items-center d-flex">
                        <h4 class="card-title mb-0 flex-grow-1">Generate Invoice</h4>
                    </div>
                    <br />
                    <div class="card-body">
                        <div class="live-preview">
                            <form method="post" asp-controller="Bill" asp-action="GenerateInvoice">
                                <div class="row">
                                    <div class="col-2">
                                        <div class="mb-3">
                                            <label asp-for="GoldRate" class="control-label">Gold Rate</label>
                                            <input asp-for="GoldRate" value="73269" class="form-control" required id="goldRate" />
                                            <span asp-validation-for="GoldRate" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="mb-3">
                                            <label asp-for="GoldMakingCharges" class="control-label">Gold Labour</label>
                                            <input asp-for="GoldMakingCharges" value="450" class="form-control" required id="goldLabour" />
                                            <span asp-validation-for="GoldMakingCharges" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="mb-3">
                                            <label asp-for="SilverRate" class="control-label">Silver Rate</label>
                                            <input asp-for="SilverRate" value="93109" class="form-control" required id="silverRate" />
                                            <span asp-validation-for="SilverRate" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="mb-3">
                                            <label asp-for="SilverMakingCharges" class="control-label">Silver Labour</label>
                                            <input asp-for="SilverMakingCharges" value="100" class="form-control" required id="silverLabour" />
                                            <span asp-validation-for="SilverMakingCharges" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="mb-3">
                                            <label asp-for="InvoiceDate" class="control-label">Invoice Date</label>
                                            <input asp-for="InvoiceDate" type="date" class="form-control" required id="invoiceDate" />
                                            <span asp-validation-for="InvoiceDate" class="text-danger"></span>
                                        </div>
                                    </div>

                                    <script>
                                        const today = new Date().toISOString().substr(0, 10);
                                        document.getElementById('invoiceDate').value = today;
                                    </script>

                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label asp-for="CustomerName" class="control-label">Customer Name</label>
                                            <input asp-for="CustomerName" class="form-control" required id="customerName" />
                                            <span asp-validation-for="CustomerName" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label asp-for="ContactNumber" class="control-label">Contact Number</label>
                                            <input asp-for="ContactNumber" type="text" class="form-control" required id="contactNumber" />
                                            <span asp-validation-for="ContactNumber" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label asp-for="Email" class="control-label"></label>
                                            <input asp-for="Email" type="email" class="form-control" required id="email" />
                                            <span asp-validation-for="Email" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label asp-for="DateOfBirth" class="control-label">Date of Birth</label>
                                            <input asp-for="DateOfBirth" type="date" class="form-control" required id="dateOfBirth" />
                                            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>

                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Type</th>
                                            <th>HUID</th>
                                            <th>Weight</th>
                                            <th>Price</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoiceItemsContainer">
                                        @for (var i = 0; i < Model.InvoiceItemLists.Count; i++)
                                        {
                                            <tr>
                                                <td>
                                                    <input asp-for="@Model.InvoiceItemLists[i].ProductName" class="form-control" />
                                                    <span asp-validation-for="@Model.InvoiceItemLists[i].ProductName" class="text-danger"></span>
                                                </td>
                                                <td>
                                                    <select asp-for="@Model.InvoiceItemLists[i].ProductType" class="form-control metal-select">
                                                        <option value="">Select Type</option>
                                                        <option value="Gold">Gold</option>
                                                        <option value="Silver">Silver</option>
                                                    </select>
                                                    <span asp-validation-for="@Model.InvoiceItemLists[i].ProductType" class="text-danger"></span>
                                                </td>
                                                <td>
                                                    <input asp-for="@Model.InvoiceItemLists[i].HUID" class="form-control" />
                                                    <span asp-validation-for="@Model.InvoiceItemLists[i].HUID" class="text-danger"></span>
                                                </td>
                                                <td>
                                                    <input asp-for="@Model.InvoiceItemLists[i].Weight" class="form-control product-weight" />
                                                    <span asp-validation-for="@Model.InvoiceItemLists[i].Weight" class="text-danger"></span>
                                                </td>
                                                <td>
                                                    <input asp-for="@Model.InvoiceItemLists[i].Price" class="form-control" readonly />
                                                    <span asp-validation-for="@Model.InvoiceItemLists[i].Price" class="text-danger"></span>
                                                </td>
                                                <td>
                                                    <button type="button" class="btn btn-danger" onclick="removeInvoiceItem(this)">Remove</button>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <button type="button" class="btn btn-primary" onclick="addInvoiceItem()">Add Item</button>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label>Total Gold Weight</label>
                                            <input type="text" id="totalGoldWeight" class="form-control" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label>Total Silver Weight</label>
                                            <input type="text" id="totalSilverWeight" class="form-control" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label>Loan Amount</label>
                                            <input type="text" id="loanAmount" class="form-control" readonly />
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- end card-body -->
                </div>
                <!-- end card -->
            </div>
            <!-- end col -->
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function addInvoiceItem() {
            var container = document.getElementById("invoiceItemsContainer");
            var rowCount = container.rows.length;
            var row = container.insertRow(rowCount);

            var cell1 = row.insertCell(0);
            cell1.innerHTML = '<input name="InvoiceItemLists[' + rowCount + '].ProductName" class="form-control" />';

            var cell2 = row.insertCell(1);
            cell2.innerHTML = '<select name="InvoiceItemLists[' + rowCount + '].ProductType" class="form-control metal-select"><option value="">Select Type</option><option value="Gold">Gold</option><option value="Silver">Silver</option></select>';

            var cell3 = row.insertCell(2);
            cell3.innerHTML = '<input name="InvoiceItemLists[' + rowCount + '].HUID" class="form-control" />';

            var cell4 = row.insertCell(3);
            cell4.innerHTML = '<input name="InvoiceItemLists[' + rowCount + '].Weight" class="form-control product-weight" oninput="calculateTotals()" />';

            var cell5 = row.insertCell(4);
            cell5.innerHTML = '<input name="InvoiceItemLists[' + rowCount + '].Price" class="form-control" readonly />';

            var cell6 = row.insertCell(5);
            cell6.innerHTML = '<button type="button" class="btn btn-danger" onclick="removeInvoiceItem(this)">Remove</button>';
        }

        function removeInvoiceItem(button) {
            var row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            calculateTotals();
        }

        function calculateTotals() {
            var totalGoldWeight = 0;
            var totalSilverWeight = 0;
            var totalGoldAmount = 0;
            var totalSilverAmount = 0;

            $("#invoiceItemsContainer tr").each(function () {
                var metal = $(this).find(".metal-select").val();
                var weight = parseFloat($(this).find(".product-weight").val()) || 0;
                var goldRate = parseFloat($("#goldRate").val()) || 0;
                var silverRate = parseFloat($("#silverRate").val()) || 0;

                if (metal === "Gold") {
                    totalGoldWeight += weight;
                    totalGoldAmount += weight * goldRate;
                } else if (metal === "Silver") {
                    totalSilverWeight += weight;
                    totalSilverAmount += weight * silverRate;
                }
            });

            var totalWeight = totalGoldWeight + totalSilverWeight;
            var loanAmount = totalGoldAmount + totalSilverAmount;

            $("#totalGoldWeight").val(totalGoldWeight.toFixed(2));
            $("#totalSilverWeight").val(totalSilverWeight.toFixed(2));
            $("#loanAmount").val(loanAmount.toFixed(2));
        }
    </script>
}
 *@